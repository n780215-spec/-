<!DOCTYPE html>
<html lang="zh-Hant">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>購物清單</title>
<style>
body { font-family: "Microsoft JhengHei", sans-serif; padding: 8px; background: #f9f9f9; font-size: 13px; }
h2,h3 { color: #333; font-size: 16px; margin: 8px 0; }
.table-container { margin-bottom: 8px; }
table { width: 100%; border-collapse: collapse; font-size: 13px; }
th, td { border: 1px solid #ccc; padding: 4px; text-align: center; }
th { background: #eee; font-size: 13px; }
.quantity-control { display: flex; justify-content: center; align-items: center; gap: 4px; }
.quantity-control button { padding: 2px 6px; font-size: 14px; }
.quantity-control input { width: 36px; text-align: center; }

button {
  padding: 6px 12px;
  background: #007bff;
  color: white;
  border: none;
  border-radius: 6px;
  cursor: pointer;
  margin: 4px 2px;
}
button:hover { background: #0056b3; }

#resultBox {
  background: white;
  padding: 10px;
  border-radius: 10px;
  margin-top: 10px;
  box-shadow: 0 2px 6px rgba(0,0,0,0.1);
}

/* 浮動區塊：即時計算總數 */
#floatingSummary {
  position: fixed;
  right: 10px;
  bottom: 70px; /* 避開最下方的下載/分享按鈕 */
  background: rgba(0, 123, 255, 0.9);
  color: white;
  padding: 8px 12px;
  border-radius: 10px;
  font-size: 14px;
  box-shadow: 0 4px 6px rgba(0,0,0,0.2);
  z-index: 1000;
}

/* 手機螢幕自動調整 */
@media (max-width: 480px) {
  body { font-size: 12px; }
  table { font-size: 12px; }
  th, td { padding: 3px; }
  .quantity-control button { font-size: 12px; padding: 2px 5px; }
  .quantity-control input { width: 32px; font-size: 12px; }
}
</style>
</head>
<body>
<h2>購物清單</h2>

<div class="table-container">
  <table id="productTable">
    <thead>
      <tr><th>商品名稱</th><th>價格</th><th>PV</th><th>數量</th></tr>
    </thead>
    <tbody>
      <tr><td>商品A</td><td>1000</td><td>500</td><td class="quantity-control"><button onclick="changeQty(this,-1)">-</button><input type="number" value="0" min="0" onchange="updateSummary()"><button onclick="changeQty(this,1)">+</button></td></tr>
      <tr><td>商品B</td><td>2000</td><td>1200</td><td class="quantity-control"><button onclick="changeQty(this,-1)">-</button><input type="number" value="0" min="0" onchange="updateSummary()"><button onclick="changeQty(this,1)">+</button></td></tr>
      <tr><td>保健品</td><td>1500</td><td>800</td><td class="quantity-control"><button onclick="changeQty(this,-1)">-</button><input type="number" value="0" min="0" onchange="updateSummary()"><button onclick="changeQty(this,1)">+</button></td></tr>
    </tbody>
  </table>
</div>

<h3>會員資格</h3>
<button onclick="setMembership('new')">入會費 $1000</button>
<button onclick="setMembership('renew')">續約費 $500</button>
<button onclick="setMembership('noneed')">不需繳納續約費 $0</button>

<h3>會員等級</h3>
<button onclick="setLevel('銀級')">銀級</button>
<button onclick="setLevel('金級')">金級</button>
<button onclick="setLevel('鑽石級')">鑽石級</button>

<h3>最終清單</h3>
<div id="resultBox"></div>

<!-- 圖片生成/下載 / 分享到Line -->
<div style="margin-top: 15px; text-align: center;">
  <button onclick="downloadImage()">下載清單圖片</button>
  <button onclick="shareToLine()">分享到Line</button>
</div>

<!-- 浮動區塊 -->
<div id="floatingSummary">
  商品總價：<span id="floatTotalPrice">0</span> 元<br>
  商品總PV：<span id="floatTotalPV">0</span>
</div>

<!-- 匯入 html2canvas -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>

<script>
let membership = "";
let membershipFee = 0;
let level = "";

// 修改數量
function changeQty(btn, delta) {
  const input = btn.parentNode.querySelector("input");
  input.value = Math.max(0, parseInt(input.value) + delta);
  updateSummary();
}

function setMembership(type) {
  if (type === "new") { membership = "入會費"; membershipFee = 1000; }
  else if (type === "renew") { membership = "續約費"; membershipFee = 500; }
  else if (type === "noneed") { membership = "已繳納續約費"; membershipFee = 0; }
  updateSummary();
}

function setLevel(lv) { level = lv; updateSummary(); }

function updateSummary() {
  const rows = document.querySelectorAll("#productTable tbody tr");
  let details = "";
  let totalPrice = 0;
  let totalPV = 0;
  let healthCount = 0;

  rows.forEach(row => {
    const name = row.cells[0].innerText;
    const price = parseInt(row.cells[1].innerText);
    const pv = parseInt(row.cells[2].innerText);
    const qty = parseInt(row.querySelector("input").value);
    if (qty > 0) {
      details += `${name} x${qty} = ${price*qty}元, PV=${pv*qty}<br>`;
      totalPrice += price*qty;
      totalPV += pv*qty;
      if (name.includes("保健品")) healthCount += qty;
    }
  });

  // 保健品滿 8 件，送 1 件同商品
  if (healthCount >= 8) details += `🎁 贈品：保健品 ${Math.floor(healthCount/8)} 件<br>`;

  // 計算贈品（取最大獎勵）
  let gift = "";
  if (totalPV >= 200000) gift = "🎁 天麗幣52000元、隨行杯3個";
  else if (totalPV >= 50000) gift = "🎁 6A號1瓶、9號1瓶、12號1瓶、隨行杯1個";
  else if (totalPV >= 32000) gift = "🎁 2號1瓶、9號1瓶";
  else if (totalPV >= 19000) gift = "🎁 2號1瓶";
  else if (totalPV >= 100000) gift = "🎁 天麗幣21000元、隨行杯2個";

  if (gift) details += gift + "<br>";

  // PV 扣除新會員 28000
  let finalPV = (membership === "入會費") ? Math.max(0, totalPV - 28001) : totalPV;
  let bonus = finalPV * 0.1;

  let result = "";
  result += details || "（尚未選購商品）<br>";
  result += `商品總價：${totalPrice} 元<br>`;
  result += `總PV數：${totalPV}<br>`;
  if (membership === "已繳納續約費") {
    result += `會員費用：已繳納續約費<br>`;
  } else if (membership) {
    result += `會員費用：${membership} ${membershipFee} 元<br>`;
  }
  result += `總金額：${totalPrice + membershipFee} 元<br>`;
  if (level) result += `會員等級：${level}<br>`;
  result += `業績獎金：${bonus} 元<br>`;

  document.getElementById("resultBox").innerHTML = result;

  // 更新浮動區塊
  document.getElementById("floatTotalPrice").innerText = totalPrice;
  document.getElementById("floatTotalPV").innerText = totalPV;
}

// 下載清單圖片
function downloadImage() {
  html2canvas(document.getElementById("resultBox")).then(canvas => {
    const link = document.createElement("a");
    link.download = "shopping_list.png";
    link.href = canvas.toDataURL();
    link.click();
  });
}

// 分享到Line（文字清單）
function shareToLine() {
  const text = document.getElementById("resultBox").innerText;
  const url = "https://line.me/R/msg/text/?" + encodeURIComponent(text);
  window.open(url);
}

// 初始化
updateSummary();
</script>
</body>
</html>
