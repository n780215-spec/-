<!DOCTYPE html>
<html lang="zh">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
<title>天麗周年慶購買清單</title>

<link rel="manifest" href="manifest.json">
<meta name="theme-color" content="#4CAF50"/>
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<meta name="apple-mobile-web-app-title" content="天麗清單">
<link rel="apple-touch-icon" href="icon-192.png">

<script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>

<style>
body { 
  font-family: "Microsoft JhengHei", sans-serif; 
  padding: 4px; 
  background: #f9f9f9; 
  font-size: 12px; 
  margin: 0; 
}
h2,h3 { 
  color: #333; 
  font-size: 14px; 
  margin: 6px 0; 
}
.table-container { 
  overflow-x: hidden; 
  margin-bottom: 8px; 
}
table { 
  width: 100%; 
  border-collapse: collapse; 
  font-size: 12px; 
  min-width: 0; 
}
th, td { 
  border: 1px solid #ccc; 
  padding: 2px 3px; 
  text-align: center; 
  font-size: 12px; 
}
th:nth-child(1), td:nth-child(1) { width: 40%; text-align: left; padding-left:4px; }
th:nth-child(2), td:nth-child(2),
th:nth-child(3), td:nth-child(3),
th:nth-child(4), td:nth-child(4) { width: 20%; }

.quantity-control { 
  display: flex; 
  justify-content: center; 
  align-items: center; 
  gap: 2px; 
}
.quantity-control button { 
  padding: 1px 3px; 
  font-size: 11px; 
}
.quantity-control input { 
  width: 30px; 
  text-align: center; 
  font-size: 11px; 
}

.btn { 
  padding: 8px; 
  background: #0078D7; 
  color: white; 
  border: none; 
  border-radius: 6px; 
  cursor: pointer; 
  font-size: 12px; 
  width: 100%; 
  margin: 6px 0; 
}
.btn:hover { 
  background: #005a9e; 
}
.highlight { 
  color: red; 
  font-weight: bold; 
}
.result { 
  margin-top: 8px; 
  padding: 8px; 
  background: #fff; 
  border-radius: 6px; 
  box-shadow: 0 2px 6px rgba(0,0,0,0.1); 
  font-size: 12px; 
  line-height: 1.3; 
}
ul { 
  padding-left: 16px; 
  margin: 4px 0; 
}
.level-buttons, .membership-buttons { 
  display: flex; 
  flex-wrap: wrap; 
  gap: 4px; 
  margin-bottom: 8px; 
}
.level-buttons button, .membership-buttons button { 
  flex: 1; 
  min-width: 60px; 
  padding: 4px; 
  border: 1px solid #ccc; 
  border-radius: 6px; 
  background: #f1f1f1; 
  cursor: pointer; 
  font-size: 11px; 
}
.level-buttons button.active, .membership-buttons button.active { 
  background: #0078D7; 
  color: white; 
  border-color: #0078D7; 
}

/* 浮動區塊 */
#floatingSummary {
  position: fixed;
  right: 6px;
  bottom: 60px;
  background: rgba(0, 123, 255, 0.9);
  color: white;
  padding: 6px 10px;
  border-radius: 10px;
  font-size: 12px;
  box-shadow: 0 4px 6px rgba(0,0,0,0.2);
  z-index: 1000;
}
</style>
</head>
<body>

<h2>天麗2025周年慶訂單計算</h2>

<div class="table-container">
  <table>
    <thead>
      <tr>
        <th>產品</th>
        <th>價格</th>
        <th>PV</th>
        <th>數量</th>
      </tr>
    </thead>
    <tbody id="productTable"></tbody>
  </table>
</div>

<h2>會員資格</h2>
<div class="membership-buttons" id="membershipButtons"></div>

<h2>會員等級</h2>
<div class="level-buttons" id="memberButtons"></div>

<div class="result" id="resultBox">
  👉 請輸入數量，選擇會員資格及會員等級
</div>

<!-- 功能按鈕 -->
<button class="btn" onclick="downloadAsImage()">📥 下載清單圖片</button>
<button class="btn" onclick="resetForm()">🔄 重新整理</button>

<!-- 浮動區塊 -->
<div id="floatingSummary">
  💰 商品總價：<span id="floatTotalPrice">0</span> 元<br>
  📊 商品總PV：<span id="floatTotalPV">0</span>
</div>

<script>
const products = [
  { code: "A1", name: "A1 深層潔顏油", price: 1995, pv: 1700, health: false },
  { code: "1", name: "1號 雙效潔顏露", price: 1995, pv: 1700, health: false },
  { code: "2", name: "2號 平衡柔膚露", price: 1995, pv: 1700, health: false },
  { code: "3", name: "3號 全效緊緻眼霜", price: 3990, pv: 3500, health: false },
  { code: "4", name: "4號 煥白晶華霜", price: 4200, pv: 3600, health: false },
  { code: "5", name: "5號 均衡調理霜", price: 4200, pv: 3600, health: false },
  { code: "6A", name: "6A 亮白防護霜", price: 3990, pv: 3500, health: false },
  { code: "6B", name: "6B 潤白防護霜", price: 3990, pv: 3500, health: false },
  { code: "8", name: "8號 賦活晶華霜", price: 3990, pv: 3500, health: false },
  { code: "9", name: "9號 保濕修護霜", price: 2415, pv: 1800, health: false },
  { code: "10", name: "10號 C液", price: 3465, pv: 3000, health: false },
  { code: "12", name: "12號 煥采青春露", price: 2415, pv: 1800, health: false },
  { code: "13", name: "Bio雪肌面膜", price: 2415, pv: 1800, health: false },
  { code: "H1", name: "青春元素-F", price: 1995, pv: 1700, health: true },
  { code: "H2", name: "青春元素-L", price: 1995, pv: 1700, health: true },
  { code: "H3", name: "纖麗365第2代", price: 2625, pv: 2300, health: true },
  { code: "H4", name: "纖麗365 S1", price: 2625, pv: 2300, health: true },
  { code: "H5", name: "橄欖油", price: 3210, pv: 2400, health: true },
  { code: "H6", name: "紅參精華飲", price: 3210, pv: 2400, health: true }
];


const memberBonusRate={ "會員":0,"專員":0.25,"主任":0.3,"經理":0.35,"寶石":0.37,"鑽石":0.38,"金鑽":0.39,"顧問":0.4 };
let selectedLevel="會員";
let selectedMembership="新會員";
const membershipFee={ "新會員":1000,"續約會員":500,"不需繳納續約費":0 };

const memberButtons=document.getElementById("memberButtons");
Object.keys(memberBonusRate).forEach(level=>{
  const btn=document.createElement("button");
  btn.textContent=level;
  btn.onclick=()=>{
    selectedLevel=level;
    document.querySelectorAll(".level-buttons button").forEach(b=>b.classList.remove("active"));
    btn.classList.add("active");
    updateSummary();
  };
  if(level==="會員") btn.classList.add("active");
  memberButtons.appendChild(btn);
});

const membershipButtons=document.getElementById("membershipButtons");
Object.keys(membershipFee).forEach(type=>{
  const displayText=type==="不需繳納續約費"? "不需繳納續約費 $0" : `${type} $${membershipFee[type]}`;
  const btn=document.createElement("button");
  btn.textContent=displayText;
  btn.onclick=()=>{
    selectedMembership=type;
    document.querySelectorAll(".membership-buttons button").forEach(b=>b.classList.remove("active"));
    btn.classList.add("active");
    updateSummary();
  };
  if(type==="新會員") btn.classList.add("active");
  membershipButtons.appendChild(btn);
});

const tableBody=document.getElementById("productTable");
products.forEach((p,index)=>{
  const row=document.createElement("tr");
  row.innerHTML=`<td>${p.name}</td><td>${p.price}</td><td>${p.pv}</td>
  <td class="quantity-control">
    <button onclick="changeQty(${index},-1)">-</button>
    <input type="number" id="qty${index}" min="0" value="0" readonly>
    <button onclick="changeQty(${index},1)">+</button>
  </td>`;
  tableBody.appendChild(row);
});

function changeQty(index,delta){
  const input=document.getElementById(`qty${index}`);
  let val=parseInt(input.value)||0;
  val=Math.max(0,val+delta);
  input.value=val;
  updateSummary();
}

function anniversaryGiftsByMoney(money){
  if(money>=200000) return ["52,000 天麗幣","天麗隨行杯 3 個"];
  if(money>=100000) return ["21,000 天麗幣","天麗隨行杯 2 個"];
  if(money>=50000) return ["6A ×1","9號 ×1","12號 ×1","天麗隨行杯 1 個"];
  if(money>=32000) return ["贈品 2號 ×1","贈品 9號 ×1"];
  if(money>=19000) return ["贈品 2號 ×1"];
  return [];
}

function updateSummary(){
  let productTotal=0,totalPV=0,listHTML="",healthBonusList=[];
  products.forEach((p,index)=>{
    const qty=parseInt(document.getElementById(`qty${index}`).value)||0;
    if(qty>0){
      listHTML+=`<li>${p.name} × ${qty} = ${p.price*qty} 元 / PV ${p.pv*qty}</li>`;
      productTotal+=p.price*qty;
      totalPV+=p.pv*qty;
      if(p.health) for(let i=0;i<Math.floor(qty/8);i++) healthBonusList.push(p.name);
    }
  });

  let membershipCost=membershipFee[selectedMembership];
  let membershipLabel=selectedMembership==="新會員"? "入會費":selectedMembership==="續約會員"? "續約費":"已繳納續約費";
  let totalMoney=productTotal+(selectedMembership==="不需繳納續約費"?0:membershipCost);

  let effectivePV=totalPV;
  if(selectedMembership==="新會員") effectivePV=Math.max(0,totalPV-28001);

  const gifts=anniversaryGiftsByMoney(totalMoney);
  const performanceBonus=effectivePV*memberBonusRate[selectedLevel];

  let result=`<h3>🧾 清單</h3>
  <ul>${listHTML||"<li>未選購商品</li>"}</ul>
  <p>💰 商品總價：<span class="highlight">${productTotal}</span> 元</p>
  <p>📊 總 PV：<span class="highlight">${totalPV}</span></p>
  <p>💰 ${membershipLabel}：<span class="highlight">${membershipCost>0?membershipCost:""}</span></p>
  <p>💰 總金額：<span class="highlight">${totalMoney}</span> 元</p>
  <p>👤 會員等級：<span class="highlight">${selectedLevel}</span></p>
  ${selectedMembership==="新會員"? `<p>⚠️ 新會員 PV 扣除 28001，業績獎金計算 PV：<span class="highlight">${effectivePV}</span></p>`:""}
  <p>🎯 業績獎金：<span class="highlight">${performanceBonus.toFixed(0)}</span> 元</p>`;

  if(healthBonusList.length>0){
    result+=`<p>保健系列贈品：</p><ul>`;
    healthBonusList.forEach((item,idx)=>result+=`<li>${idx+1}. ${item}</li>`);
    result+=`</ul>`;
  }

  if(gifts.length>0){
    result+=`<h3>🎁 周年慶贈品</h3><ul>`;
    gifts.forEach(item=>result+=`<li>${item}</li>`);
    result+=`</ul>`;
  } else { result+=`<p>🎁 周年慶贈品：無符合回饋</p>`; }

  document.getElementById("resultBox").innerHTML=result;

  document.getElementById("floatTotalPrice").innerText=productTotal;
  document.getElementById("floatTotalPV").innerText=totalPV;
}

function resetForm(){
  products.forEach((p,index)=>{ document.getElementById(`qty${index}`).value=0; });
  selectedLevel="會員";
  selectedMembership="新會員";
  document.querySelectorAll(".level-buttons button, .membership-buttons button").forEach(b=>b.classList.remove("active"));
  document.querySelector(".level-buttons button").classList.add("active");
  document.querySelector(".membership-buttons button").classList.add("active");
  updateSummary();
}

function downloadAsImage(){
  const element=document.getElementById("resultBox");
  html2canvas(element,{backgroundColor:"#ffffff",scale:2}).then(canvas=>{
    const imgData=canvas.toDataURL("image/png");
    const link=document.createElement("a");
    link.href=imgData;
    link.download="天麗購買清單.png";
    link.click();
  });
}

updateSummary();
</script>
</body>
</html>
