<!DOCTYPE html>
<html lang="zh-Hant">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>è³¼ç‰©æ¸…å–®</title>
<style>
body { font-family: "Microsoft JhengHei", sans-serif; padding: 8px; background: #f9f9f9; font-size: 13px; }
h2,h3 { color: #333; font-size: 16px; margin: 8px 0; }
.table-container { margin-bottom: 8px; }
table { width: 100%; border-collapse: collapse; font-size: 13px; }
th, td { border: 1px solid #ccc; padding: 4px; text-align: center; }
th { background: #eee; font-size: 13px; }
.quantity-control { display: flex; justify-content: center; align-items: center; gap: 4px; }
.quantity-control button { padding: 2px 6px; font-size: 14px; }
.quantity-control input { width: 36px; text-align: center; }

button {
  padding: 6px 12px;
  background: #007bff;
  color: white;
  border: none;
  border-radius: 6px;
  cursor: pointer;
  margin: 4px 2px;
}
button:hover { background: #0056b3; }

#resultBox {
  background: white;
  padding: 10px;
  border-radius: 10px;
  margin-top: 10px;
  box-shadow: 0 2px 6px rgba(0,0,0,0.1);
}

/* æµ®å‹•å€å¡Šï¼šå³æ™‚è¨ˆç®—ç¸½æ•¸ */
#floatingSummary {
  position: fixed;
  right: 10px;
  bottom: 70px; /* é¿é–‹æœ€ä¸‹æ–¹çš„ä¸‹è¼‰/åˆ†äº«æŒ‰éˆ• */
  background: rgba(0, 123, 255, 0.9);
  color: white;
  padding: 8px 12px;
  border-radius: 10px;
  font-size: 14px;
  box-shadow: 0 4px 6px rgba(0,0,0,0.2);
  z-index: 1000;
}

/* æ‰‹æ©Ÿè¢å¹•è‡ªå‹•èª¿æ•´ */
@media (max-width: 480px) {
  body { font-size: 12px; }
  table { font-size: 12px; }
  th, td { padding: 3px; }
  .quantity-control button { font-size: 12px; padding: 2px 5px; }
  .quantity-control input { width: 32px; font-size: 12px; }
}
</style>
</head>
<body>
<h2>è³¼ç‰©æ¸…å–®</h2>

<div class="table-container">
  <table id="productTable">
    <thead>
      <tr><th>å•†å“åç¨±</th><th>åƒ¹æ ¼</th><th>PV</th><th>æ•¸é‡</th></tr>
    </thead>
    <tbody>
      <tr><td>å•†å“A</td><td>1000</td><td>500</td><td class="quantity-control"><button onclick="changeQty(this,-1)">-</button><input type="number" value="0" min="0" onchange="updateSummary()"><button onclick="changeQty(this,1)">+</button></td></tr>
      <tr><td>å•†å“B</td><td>2000</td><td>1200</td><td class="quantity-control"><button onclick="changeQty(this,-1)">-</button><input type="number" value="0" min="0" onchange="updateSummary()"><button onclick="changeQty(this,1)">+</button></td></tr>
      <tr><td>ä¿å¥å“</td><td>1500</td><td>800</td><td class="quantity-control"><button onclick="changeQty(this,-1)">-</button><input type="number" value="0" min="0" onchange="updateSummary()"><button onclick="changeQty(this,1)">+</button></td></tr>
    </tbody>
  </table>
</div>

<h3>æœƒå“¡è³‡æ ¼</h3>
<button onclick="setMembership('new')">å…¥æœƒè²» $1000</button>
<button onclick="setMembership('renew')">çºŒç´„è²» $500</button>
<button onclick="setMembership('noneed')">ä¸éœ€ç¹³ç´çºŒç´„è²» $0</button>

<h3>æœƒå“¡ç­‰ç´š</h3>
<button onclick="setLevel('éŠ€ç´š')">éŠ€ç´š</button>
<button onclick="setLevel('é‡‘ç´š')">é‡‘ç´š</button>
<button onclick="setLevel('é‘½çŸ³ç´š')">é‘½çŸ³ç´š</button>

<h3>æœ€çµ‚æ¸…å–®</h3>
<div id="resultBox"></div>

<!-- åœ–ç‰‡ç”Ÿæˆ/ä¸‹è¼‰ / åˆ†äº«åˆ°Line -->
<div style="margin-top: 15px; text-align: center;">
  <button onclick="downloadImage()">ä¸‹è¼‰æ¸…å–®åœ–ç‰‡</button>
  <button onclick="shareToLine()">åˆ†äº«åˆ°Line</button>
</div>

<!-- æµ®å‹•å€å¡Š -->
<div id="floatingSummary">
  å•†å“ç¸½åƒ¹ï¼š<span id="floatTotalPrice">0</span> å…ƒ<br>
  å•†å“ç¸½PVï¼š<span id="floatTotalPV">0</span>
</div>

<!-- åŒ¯å…¥ html2canvas -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>

<script>
let membership = "";
let membershipFee = 0;
let level = "";

// ä¿®æ”¹æ•¸é‡
function changeQty(btn, delta) {
  const input = btn.parentNode.querySelector("input");
  input.value = Math.max(0, parseInt(input.value) + delta);
  updateSummary();
}

function setMembership(type) {
  if (type === "new") { membership = "å…¥æœƒè²»"; membershipFee = 1000; }
  else if (type === "renew") { membership = "çºŒç´„è²»"; membershipFee = 500; }
  else if (type === "noneed") { membership = "å·²ç¹³ç´çºŒç´„è²»"; membershipFee = 0; }
  updateSummary();
}

function setLevel(lv) { level = lv; updateSummary(); }

function updateSummary() {
  const rows = document.querySelectorAll("#productTable tbody tr");
  let details = "";
  let totalPrice = 0;
  let totalPV = 0;
  let healthCount = 0;

  rows.forEach(row => {
    const name = row.cells[0].innerText;
    const price = parseInt(row.cells[1].innerText);
    const pv = parseInt(row.cells[2].innerText);
    const qty = parseInt(row.querySelector("input").value);
    if (qty > 0) {
      details += `${name} x${qty} = ${price*qty}å…ƒ, PV=${pv*qty}<br>`;
      totalPrice += price*qty;
      totalPV += pv*qty;
      if (name.includes("ä¿å¥å“")) healthCount += qty;
    }
  });

  // ä¿å¥å“æ»¿ 8 ä»¶ï¼Œé€ 1 ä»¶åŒå•†å“
  if (healthCount >= 8) details += `ğŸ è´ˆå“ï¼šä¿å¥å“ ${Math.floor(healthCount/8)} ä»¶<br>`;

  // è¨ˆç®—è´ˆå“ï¼ˆå–æœ€å¤§çå‹µï¼‰
  let gift = "";
  if (totalPV >= 200000) gift = "ğŸ å¤©éº—å¹£52000å…ƒã€éš¨è¡Œæ¯3å€‹";
  else if (totalPV >= 50000) gift = "ğŸ 6Aè™Ÿ1ç“¶ã€9è™Ÿ1ç“¶ã€12è™Ÿ1ç“¶ã€éš¨è¡Œæ¯1å€‹";
  else if (totalPV >= 32000) gift = "ğŸ 2è™Ÿ1ç“¶ã€9è™Ÿ1ç“¶";
  else if (totalPV >= 19000) gift = "ğŸ 2è™Ÿ1ç“¶";
  else if (totalPV >= 100000) gift = "ğŸ å¤©éº—å¹£21000å…ƒã€éš¨è¡Œæ¯2å€‹";

  if (gift) details += gift + "<br>";

  // PV æ‰£é™¤æ–°æœƒå“¡ 28000
  let finalPV = (membership === "å…¥æœƒè²»") ? Math.max(0, totalPV - 28001) : totalPV;
  let bonus = finalPV * 0.1;

  let result = "";
  result += details || "ï¼ˆå°šæœªé¸è³¼å•†å“ï¼‰<br>";
  result += `å•†å“ç¸½åƒ¹ï¼š${totalPrice} å…ƒ<br>`;
  result += `ç¸½PVæ•¸ï¼š${totalPV}<br>`;
  if (membership === "å·²ç¹³ç´çºŒç´„è²»") {
    result += `æœƒå“¡è²»ç”¨ï¼šå·²ç¹³ç´çºŒç´„è²»<br>`;
  } else if (membership) {
    result += `æœƒå“¡è²»ç”¨ï¼š${membership} ${membershipFee} å…ƒ<br>`;
  }
  result += `ç¸½é‡‘é¡ï¼š${totalPrice + membershipFee} å…ƒ<br>`;
  if (level) result += `æœƒå“¡ç­‰ç´šï¼š${level}<br>`;
  result += `æ¥­ç¸¾çé‡‘ï¼š${bonus} å…ƒ<br>`;

  document.getElementById("resultBox").innerHTML = result;

  // æ›´æ–°æµ®å‹•å€å¡Š
  document.getElementById("floatTotalPrice").innerText = totalPrice;
  document.getElementById("floatTotalPV").innerText = totalPV;
}

// ä¸‹è¼‰æ¸…å–®åœ–ç‰‡
function downloadImage() {
  html2canvas(document.getElementById("resultBox")).then(canvas => {
    const link = document.createElement("a");
    link.download = "shopping_list.png";
    link.href = canvas.toDataURL();
    link.click();
  });
}

// åˆ†äº«åˆ°Lineï¼ˆæ–‡å­—æ¸…å–®ï¼‰
function shareToLine() {
  const text = document.getElementById("resultBox").innerText;
  const url = "https://line.me/R/msg/text/?" + encodeURIComponent(text);
  window.open(url);
}

// åˆå§‹åŒ–
updateSummary();
</script>
</body>
</html>
