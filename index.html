<!DOCTYPE html>
<html lang="zh">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>å¤©éº—å‘¨å¹´æ…¶è³¼è²·æ¸…å–®</title>
<link rel="manifest" href="manifest.json">
<meta name="theme-color" content="#4CAF50"/>
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<meta name="apple-mobile-web-app-title" content="å¤©éº—æ¸…å–®">
<link rel="apple-touch-icon" href="icon-192.png">
<script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
<style>
body { font-family: "Microsoft JhengHei", sans-serif; padding: 8px; background: #f9f9f9; font-size: 13px; }
h2,h3 { color: #333; font-size: 16px; margin: 8px 0; }
.table-container { overflow-x: auto; margin-bottom: 8px; }
table { width: 100%; border-collapse: collapse; font-size: 13px; min-width: 480px; }
th, td { border: 1px solid #ccc; padding: 4px; text-align: center; }
th { background: #eee; font-size: 13px; }
input[type=number] { width: 55px; padding: 4px; text-align: center; font-size: 13px; }
.btn { padding: 10px; background: #0078D7; color: white; border: none; border-radius: 6px; cursor: pointer; font-size: 14px; width: 100%; margin: 8px 0; }
.btn:hover { background: #005a9e; }
.highlight { color: red; font-weight: bold; }
.result { margin-top: 8px; padding: 10px; background: #fff; border-radius: 6px; box-shadow: 0 2px 6px rgba(0,0,0,0.1); font-size: 13px; line-height: 1.4; }
ul { padding-left: 18px; margin: 4px 0; }
.level-buttons, .membership-buttons { display: flex; flex-wrap: wrap; gap: 4px; margin-bottom: 8px; }
.level-buttons button, .membership-buttons button { flex: 1; min-width: 70px; padding: 6px; border: 1px solid #ccc; border-radius: 6px; background: #f1f1f1; cursor: pointer; font-size: 12px; }
.level-buttons button.active, .membership-buttons button.active { background: #0078D7; color: white; border-color: #0078D7; }
#generatedImage { width: 100%; margin-top: 10px; border: 1px solid #ccc; border-radius: 6px; }
</style>
</head>
<body>

<h2>å¤©éº—2025å‘¨å¹´æ…¶è¨‚å–®è¨ˆç®—</h2>

<div class="table-container">
  <table>
    <thead>
      <tr>
        <th>ç”¢å“</th>
        <th>åƒ¹æ ¼</th>
        <th>PV</th>
        <th>æ•¸é‡</th>
      </tr>
    </thead>
    <tbody id="productTable"></tbody>
  </table>
</div>

<h2>æœƒå“¡è³‡æ ¼</h2>
<div class="membership-buttons" id="membershipButtons"></div>

<h2>æœƒå“¡ç­‰ç´š</h2>
<div class="level-buttons" id="memberButtons"></div>

<div class="result" id="resultBox">
  ğŸ‘‰ è«‹è¼¸å…¥æ•¸é‡ï¼Œé¸æ“‡æœƒå“¡è³‡æ ¼åŠæœƒå“¡ç­‰ç´š
</div>

<button class="btn" onclick="generateImage()">ç”Ÿæˆæ¸…å–®åœ–ç‰‡</button>
<button class="btn" onclick="shareToLine()">åˆ†äº«åˆ° Line</button>

<img id="generatedImage" src="" alt="ç”Ÿæˆçš„æ¸…å–®åœ–ç‰‡" style="display:none;">

<script>
const products = [
  { code: "A1", name: "A1æ·±å±¤ä¿®è­·ç²¾æ²¹", price: 1995, pv: 1700, health: false },
  { code: "1", name: "1 é›™æ•ˆæ½”é¡éœ²", price: 1995, pv: 1700, health: false },
  { code: "2", name: "2 å¹³è¡¡æŸ”è†šéœ²", price: 1995, pv: 1700, health: false },
  { code: "3", name: "3 å…¨æ•ˆç·Šç·»çœ¼éœœ", price: 3990, pv: 3500, health: false },
  { code: "4", name: "4 ç…¥ç™½æ™¶è¯éœœ", price: 4200, pv: 3600, health: false },
  { code: "5", name: "5 å‡è¡¡èª¿ç†éœœ", price: 4200, pv: 3600, health: false },
  { code: "6A", name: "6A äº®ç™½é˜²æ›¬", price: 3990, pv: 3500, health: false },
  { code: "6B", name: "6B æ½¤ç™½é˜²æ›¬", price: 3990, pv: 3500, health: false },
  { code: "8", name: "8 è³¦æ´»æ™¶è¯éœœ", price: 3990, pv: 3500, health: false },
  { code: "9", name: "9 ä¿æ¿•ä¿®è­·éœœ", price: 2415, pv: 1800, health: false },
  { code: "10", name: "10 Cæ¶²", price: 3465, pv: 3000, health: false },
  { code: "12", name: "12 ç…¥é‡‡é’æ˜¥éœ²", price: 2415, pv: 1800, health: false },
  { code: "C1", name: "Cç²‰/ç“¶", price: 3465, pv: 3000, health: false },
  { code: "C10", name: "Cç²‰/10ç“¶/ç›’", price: 29400, pv: 26000, health: false },
  { code: "H1", name: "é’æ˜¥å…ƒç´ -F 30åŒ…", price: 1995, pv: 1700, health: true },
  { code: "H2", name: "é’æ˜¥å…ƒç´ -L 30åŒ…", price: 1995, pv: 1700, health: true },
  { code: "H3", name: "çº–éº— 30åŒ…", price: 2625, pv: 2300, health: true },
  { code: "H4", name: "çº–éº—S1 30åŒ…", price: 2625, pv: 2300, health: true },
  { code: "H5", name: "æ©„æ¬–æ²¹", price: 3210, pv: 2400, health: true },
  { code: "H6", name: "ç´…åƒç²¾è¯é£²", price: 3210, pv: 2400, health: true }
];

const memberBonusRate = { "æœƒå“¡":0,"å°ˆå“¡":0.25,"ä¸»ä»»":0.3,"ç¶“ç†":0.35,"å¯¶çŸ³":0.37,"é‘½çŸ³":0.38,"é‡‘é‘½":0.39,"é¡§å•":0.4 };
let selectedLevel = "æœƒå“¡";
let selectedMembership = "æ–°æœƒå“¡";
const membershipFee = { "æ–°æœƒå“¡":1000, "çºŒç´„æœƒå“¡":500, "ä¸éœ€ç¹³ç´çºŒç´„è²»":0 };

// æœƒå“¡ç­‰ç´šæŒ‰éˆ•
const memberButtons = document.getElementById("memberButtons");
Object.keys(memberBonusRate).forEach(level=>{
  const btn = document.createElement("button");
  btn.textContent = level;
  btn.onclick = () => {
    selectedLevel = level;
    document.querySelectorAll(".level-buttons button").forEach(b=>b.classList.remove("active"));
    btn.classList.add("active");
    updateSummary();
  };
  if(level==="æœƒå“¡") btn.classList.add("active");
  memberButtons.appendChild(btn);
});

// æœƒå“¡è³‡æ ¼æŒ‰éˆ•
const membershipButtons = document.getElementById("membershipButtons");
Object.keys(membershipFee).forEach(type=>{
  const displayText = type==="ä¸éœ€ç¹³ç´çºŒç´„è²»" ? "ä¸éœ€ç¹³ç´çºŒç´„è²» $0" : `${type} $${membershipFee[type]}`;
  const btn = document.createElement("button");
  btn.textContent = displayText;
  btn.onclick = () => {
    selectedMembership = type;
    document.querySelectorAll(".membership-buttons button").forEach(b=>b.classList.remove("active"));
    btn.classList.add("active");
    updateSummary();
  };
  if(type==="æ–°æœƒå“¡") btn.classList.add("active");
  membershipButtons.appendChild(btn);
});

// ç”¢å“è¡¨æ ¼
const tableBody = document.getElementById("productTable");
products.forEach((p,index)=>{
  const row = document.createElement("tr");
  row.innerHTML = `<td>${p.name}</td><td>${p.price}</td><td>${p.pv}</td><td><input type="number" id="qty${index}" min="0" value="0"></td>`;
  tableBody.appendChild(row);
  row.querySelector("input").addEventListener("input", updateSummary);
});

// æ›´æ–°æ¸…å–®
function updateSummary(){
  let productTotal=0, totalPV=0, listHTML="", healthBonusList=[];
  products.forEach((p,index)=>{
    const qty=parseInt(document.getElementById(`qty${index}`).value)||0;
    if(qty>0){
      listHTML+=`<li>${p.name} Ã— ${qty} = ${p.price*qty} å…ƒ / PV ${p.pv*qty}</li>`;
      productTotal+=p.price*qty;
      totalPV+=p.pv*qty;
      if(p.health) for(let i=0;i<Math.floor(qty/8);i++) healthBonusList.push(p.name);
    }
  });

  let membershipCost = membershipFee[selectedMembership];
  let membershipLabel = selectedMembership==="æ–°æœƒå“¡" ? "å…¥æœƒè²»" : selectedMembership==="çºŒç´„æœƒå“¡" ? "çºŒç´„è²»" : "å·²ç¹³ç´çºŒç´„è²»";
  let totalMoney = productTotal + (selectedMembership==="ä¸éœ€ç¹³ç´çºŒç´„è²»" ? 0 : membershipCost);

  let effectivePV = totalPV;
  if(selectedMembership==="æ–°æœƒå“¡") effectivePV = Math.max(0, totalPV - 28000);

  const performanceBonus = effectivePV * memberBonusRate[selectedLevel];

  let result=`ğŸ§¾ æ¸…å–®\n`;
  result += listHTML.replace(/<li>/g,"- ").replace(/<\/li>/g,"\n");
  result += `ğŸ’° å•†å“ç¸½åƒ¹ï¼š${productTotal} å…ƒ\n`;
  result += `ğŸ“Š ç¸½ PVï¼š${totalPV}\n`;
  result += `ğŸ’° ${membershipLabel}ï¼š${membershipCost>0 ? membershipCost : ""}\n`;
  result += `ğŸ’° æœ€çµ‚é‡‘é¡ï¼š${totalMoney} å…ƒ\n`;
  result += `ğŸ‘¤ æœƒå“¡ç­‰ç´šï¼š${selectedLevel}\n`;
  if(selectedMembership==="æ–°æœƒå“¡") result += `âš ï¸ æ–°æœƒå“¡ PV æ‰£é™¤ 28000ï¼Œæ¥­ç¸¾çé‡‘è¨ˆç®— PVï¼š${effectivePV}\n`;
  result += `ğŸ¯ æ¥­ç¸¾çé‡‘ï¼š${performanceBonus.toFixed(0)} å…ƒ\n`;

  document.getElementById("resultBox").innerText = result;
}

// ç”Ÿæˆåœ–ç‰‡
function generateImage(){
  const element = document.getElementById("resultBox");
  html2canvas(element, {backgroundColor:"#ffffff", scale:2}).then(canvas=>{
    const imgData = canvas.toDataURL("image/png");
    const img = document.getElementById("generatedImage");
    img.src = imgData;
    img.style.display = "block";
  });
}

// åˆ†äº«åˆ° Line
function shareToLine(){
  const img = document.getElementById("generatedImage");
  if(!img.src){
    alert("è«‹å…ˆç”Ÿæˆæ¸…å–®åœ–ç‰‡");
    return;
  }
  // ç”¨åœ–ç‰‡ URLï¼ˆBase64ï¼‰åšåˆ†äº«æ–‡å­—æç¤º
  const text = "æŸ¥çœ‹æˆ‘çš„å¤©éº—è³¼è²·æ¸…å–®\n" + img.src;
  const url = "https://line.me/R/msg/text/?" + encodeURIComponent(text);
  window.open(url);
}

// åˆå§‹åŒ–
updateSummary();
</script>
</body>
</html>
